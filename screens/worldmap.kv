#:import MapView kivy.garden.mapview.MapView

<MapScreen>:
    mapview: mapview

    FloatLayout:
        WorldMapView:
            id: mapview
            preview_coordinate: None
            add_meeting: False
            #min_zoom: 11
            lat: 48.8534
            lon: 2.3488
            on_add_meeting:
                popup = Factory.AddMeetingMenu()
                popup.coordinate = self.preview_coordinate
                popup.target = self
                popup.tmp_marker = self.tmp_map_marker
                self.add_meeting = False
                popup.open()

        AddMarkerButton:
            pos_hint: {'center': (.05, .95)}

            on_press: mapview.marker_triggered = True

        #AddMeetingMenu:
        #    pos_hint: {'center_x': .5}
        #    size_hint_y: .7
        #    y: -(root.height) if not mapview.add_meeting else 0
        #    opacity: 1 if mapview.add_meeting else 0
        #    disabled: True if not mapview.add_meeting else False
        # button to repositionnate

<AddMarkerButton@ImageButton>:
    source: 'data/images/add_marker.png'
    size_hint: None, None
    size: self.texture_size

<AddMeetingMenu>:
    title: title.text
    comment: comment.text
    level: int(level.spinner_option) if level.spinner_option else 0
    target: None
    tmp_marker: None
    pos_hint: {'x': 1}

    canvas:
        Clear:

    FloatLayout:
        BoxLayout:
            orientation: 'vertical'
            padding: (dp(20),)
            pos_hint: {'top': 1}
            size_hint_y: .6
            on_touch_down:
                touch = args[1]
                root.target.remove_marker(root.tmp_marker)
                if not self.collide_point(*touch.pos): root.dismiss()

            canvas.before:
                Color:
                    a: .1
                Rectangle:
                    pos: self.x, self.y - self.height
                    size: [wh * 4 for wh in self.size]
                Color:
                BorderImage:
                    source: 'data/images/shadow.png'
                    border: 18, 18, 18, 18
                    pos: [xy - dp(15) for xy in self.pos]
                    size: [wh + dp(30) for wh in self.size]
                Color:
                Rectangle:
                    pos: self.pos
                    size: self.size

            StyledLabel:
                bold: True
                color: rgba('#000000')
                font_size: sp(26)
                halign: 'center'
                text: 'add a meeting :'.upper()
                text_size: self.width, None

            InputLine:
                id: level
                title: 'level:'
                textinput: False
                values: ['1', '2', '3']

            InputLine:
                id: title
                title: 'title'

            InputLine:
                id: comment
                title: 'comment'
                multiline: True

            Widget:

            BoxLayout:
                spacing: dp(15)
                pos_hint: {'center_x': .5}
                size_hint: None, None
                size: self.minimum_size

                SubmitButton:
                    text: 'add event'.upper()
                    on_release: root.add_meeting()

                SubmitButton:
                    text: 'cancel'.upper()
                    on_release: root.dismiss()


<InputLine@BoxLayout>:
    text: textinput.text
    spinner_option: spinner.text
    title: ''
    textinput: True
    values: []
    multiline: False

    StyledLabel:
        text: (root.title).upper()
        font_size: sp(16)
        color: rgba('#000000')

    StyledTextInput:
        id: textinput
        multiline: root.multiline
        opacity: 1 if root.textinput else 0
        disabled: False if root.textinput else True
        pos_hint: {'center_y': .5}
        size_hint: (1 if root.textinput else .001), .4 if not root.multiline else .9

    StyledSpinner:
        id: spinner
        values: root.values
        opacity: 1 if not root.textinput else 0
        disabled: False if not root.textinput else True
        pos_hint: {'center_y': .5}
        size_hint: (1 if not root.textinput else .001), .4


<EventInfoPopup>:
    container: container

    canvas:
        Clear:

    FloatLayout:
        BoxLayout:
            id: container
            orientation: 'vertical'
            pos_hint: {'center': (.5, .5)}
            size_hint: .8, .8

            canvas.before:
                Color:
                Rectangle:
                    pos: self.pos
                    size: self.size

<EventItemBox>:
    title: ''
    content: ''

    StyledLabel:
        text: '{}:'.format(root.title)
        color: 0, 0, 0, 1
        bold: True

    StyledLabel:
        text: root.content
        color: 0, 0, 0, 1
